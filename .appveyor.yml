image: Visual Studio 2017

build:
  verbosity: detailed

configuration: Release

# environment:
  # nodejs_version: "Current"
  # matrix:
  #   - arch: x64
  #
cache:


on_finish:
  - ps: $blockRdp = $true; iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))

install:
  # - call "C:\Program Files (x86)\Microsoft Visual Studio\2017\Community\VC\Auxiliary\Build\vcvars64.bat"

  ############################################################################
  # Install Ninja
  ############################################################################
  - choco install ninja
  #- choco install strawberryperl
  #- choco install nasm

  ############################################################################
  # Install GYP
  ############################################################################
  - mkdir C:\projects\deps
  - cd C:\projects\deps
    #- git clone https://github.com/leohahn/gyp
  - git clone https://chromium.googlesource.com/external/gyp
  - cd gyp
  - python setup.py install

before_build:
  #- cd C:\projects\libpitaya\deps\openssl\openssl
  #- mkdir _build
  #- cd _build
  #- perl ..\Configure VC-WIN64A no-asm
  #- nmake
  #- nmake install

  - cd C:\projects\libpitaya
  - gyp --depth=. pomelo.gyp -f ninja --generator-output=build -Duse_sys_openssl=true -Dbuild_type=Release -Dbuild_cspomelo=true -Dbuild_for_windows=true

build_script:
    #- cd build/out/Default
    #- cat build.ninja
    #- ninja
    #- dir
  - cd build\out\Default
  - ninja
  # - cat libpitaya.vcxproj
  # - msbuild pomelo.sln /t:Build /p:Configuration=Release /p:Platform=Win32
    #- ninja
